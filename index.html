<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FluidPowerTools — Time Tracker</title>
    <meta name="description" content="Track engineering project time locally and export your data for backup or reporting." />
    <meta name="theme-color" content="#0a0c10" />
    <link rel="stylesheet" href="assets/vendor/flatpickr/flatpickr.min.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234cc9f0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M3 12h5l3-8 3 16 3-8h4'/></svg>" />
    <script src="assets/vendor/flatpickr/flatpickr.min.js" defer></script>
    <script src="assets/js/idleDetection.js" defer></script>
    <script src="assets/js/app.js" defer></script>
  </head>
  <body>
    <header>
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 12h5l3-8 3 16 3-8h4" stroke="#4cc9f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      <h1>Time Tracker</h1>
      <span class="tag">Standalone • Local only</span>
      <span class="spacer" aria-hidden="true"></span>
      <button
        id="actionToggle"
        class="btn-ghost menu-toggle"
        type="button"
        aria-expanded="false"
        aria-controls="actionMenu"
      >
        Actions
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path
            d="M6 9l6 6 6-6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
      <div id="actionMenu" class="header-actions">
        <button id="btnExport" class="btn-ghost" type="button">Export JSON</button>
        <input id="importFile" class="hidden" type="file" accept="application/json" />
        <button id="btnImport" class="btn-ghost" type="button">Import</button>
        <button id="btnCsv" class="btn-ghost" type="button">Export CSV</button>
        <button id="btnClear" class="btn-danger" type="button">Clear All</button>
      </div>
    </header>

    <main class="container">
      <div class="tabs" style="margin-bottom: 20px">
        <button id="tabActiveProjects" aria-selected="true" type="button">Active Projects</button>
        <button id="tabArchivedProjects" aria-selected="false" type="button">Archived Projects</button>
      </div>

      <div id="activeSection">
        <div class="grid">
          <section class="card" aria-labelledby="active-projects-heading">
            <div class="h">
              <h2 id="active-projects-heading">Projects</h2>
              <div class="row">
                <button id="openProjectModal" class="btn-primary" type="button">New Project</button>
              </div>
            </div>
            <div class="b project-wrap" id="projectList"></div>
          </section>

          <section class="card" aria-labelledby="timer-heading">
            <div class="h">
              <h2 id="timer-heading">Timer</h2>
              <div class="row">
                <label class="sr-only" for="projectSelect">Project</label>
                <select id="projectSelect" aria-label="Select project"></select>
                <button id="startBtn" class="btn-accent" type="button">Start</button>
                <button id="stopBtn" type="button">Stop</button>
                <button id="openManualModal" class="btn-ghost" type="button">Manual Entry</button>
              </div>
            </div>
            <div class="b">
              <div class="pill" aria-live="polite">Current session</div>
              <div id="timeDisplay">00:00:00</div>
              <div id="noteBar">
                <div class="row">
                  <label class="sr-only" for="noteInput">Session note</label>
                  <input id="noteInput" placeholder="Add a note for this session..." />
                  <button id="saveNoteBtn" class="btn-primary" type="button">Save</button>
                  <button id="cancelNoteBtn" class="btn-ghost" type="button">Cancel</button>
                </div>
              </div>
              <div id="idlePermissionNotice" class="hidden" role="status">
                <span data-idle-permission-message>
                  Idle detection permission is needed to pause the timer when your screen locks.
                </span>
                <button id="idlePermissionButton" class="btn-ghost" type="button">Enable Away Tracking</button>
              </div>
            </div>
          </section>
        </div>

        <section class="card" style="margin-top: 20px" aria-labelledby="totals-heading">
          <div class="h">
            <h2 id="totals-heading">Totals</h2>
            <div class="row" style="margin-left: auto">
              <div class="tabs">
                <button id="tabDaily" aria-selected="true" type="button">Daily</button>
                <button id="tabWeekly" aria-selected="false" type="button">Weekly</button>
                <button id="tabAll" aria-selected="false" type="button">All-Time</button>
              </div>
              <button id="prevRange" class="btn-ghost" type="button" aria-label="Previous range">◀</button>
              <div id="rangeLabel" class="pill">Today</div>
              <button id="nextRange" class="btn-ghost" type="button" aria-label="Next range">▶</button>
            </div>
          </div>
          <div class="b">
            <table>
              <thead>
                <tr>
                  <th scope="col">Project</th>
                  <th scope="col">Entries</th>
                  <th scope="col">Total Time</th>
                </tr>
              </thead>
              <tbody id="totalsBody"></tbody>
            </table>
          </div>
        </section>

        <section class="card" style="margin-top: 20px" aria-labelledby="entries-heading">
          <div class="h">
            <h2 id="entries-heading">All Entries (Active Projects)</h2>
          </div>
          <div class="b" id="activeEntries"></div>
        </section>
      </div>

      <div id="archivedSection" class="hidden">
        <section class="card" aria-labelledby="archived-heading">
          <div class="h">
            <h2 id="archived-heading">Archived Projects</h2>
          </div>
          <div class="b project-wrap" id="archivedProjects"></div>
        </section>
      </div>
    </main>

    <div id="projectModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="projectModalTitle">
      <div class="dialog">
        <div class="h">
          <h2 id="projectModalTitle">New Project</h2>
          <button id="closeProject" class="btn-ghost" type="button" aria-label="Close project form">✕</button>
        </div>
        <div class="b">
          <div class="form-grid modal-form-grid">
            <div class="form-field">
              <label class="muted" for="projNo">Project Number</label>
              <input id="projNo" placeholder="e.g. 455227" required />
            </div>
            <div class="form-field">
              <label class="muted" for="taskNo">Task Number</label>
              <input id="taskNo" placeholder="e.g. HTK-03" />
            </div>
            <div class="form-field full-span">
              <label class="muted" for="projName">Project Name</label>
              <input id="projName" placeholder="e.g. BBL-1000 Hydraulic Tank" required />
            </div>
            <div class="form-field">
              <label class="muted" for="startDate">Start Date</label>
              <input id="startDate" type="date" required />
            </div>
            <div class="form-field">
              <label class="muted" for="endDate">End Date (optional)</label>
              <input id="endDate" type="date" />
            </div>
            <div class="form-field">
              <label class="muted" for="statusSel">Status</label>
              <select id="statusSel">
                <option>In Queue</option>
                <option>WIP</option>
                <option>On Hold</option>
                <option>Completed</option>
              </select>
            </div>
            <div class="form-field full-span">
              <label class="muted" for="projNote">Notes</label>
              <textarea id="projNote" placeholder="Optional context for this project..."></textarea>
            </div>
          </div>
          <input type="hidden" id="editingProjectId" />
          <div class="row" style="justify-content: flex-end">
            <button id="saveProject" class="btn-primary" type="button">Save Project</button>
          </div>
        </div>
      </div>
    </div>

    <div
      id="manualModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="manualModalTitle"
    >
      <div class="dialog">
        <div class="h">
          <h2 id="manualModalTitle">Manual Time Entry</h2>
          <button id="closeManualModal" class="btn-ghost" type="button" aria-label="Close manual entry form">✕</button>
        </div>
        <div class="b">
          <div class="form-grid session-form modal-form-grid">
            <div class="form-field field-project">
              <label class="muted" for="manualProject">Project</label>
              <select id="manualProject" required></select>
            </div>
            <div class="form-field field-start">
              <label class="muted" for="manualStartDate">Start</label>
              <div class="input-split">
                <input id="manualStartDate" type="date" required />
                <input id="manualStartTime" type="time" required />
              </div>
            </div>
            <div class="form-field field-end">
              <label class="muted" for="manualEndDate">End</label>
              <div class="input-split">
                <input id="manualEndDate" type="date" required />
                <input id="manualEndTime" type="time" required />
              </div>
            </div>
            <div class="form-field field-duration">
              <label class="muted" for="manualDuration">Duration</label>
              <div id="manualDuration" class="session-duration" aria-live="polite">—</div>
            </div>
            <div class="form-field field-notes full-span">
              <label class="muted" for="manualNote">Notes</label>
              <textarea id="manualNote" placeholder="Optional context for this session..."></textarea>
            </div>
          </div>
          <div class="row" style="justify-content: flex-end">
            <button id="saveManualEntry" class="btn-primary" type="button">Add Entry</button>
          </div>
        </div>
      </div>
    </div>

    <div
      id="sessionModal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="sessionModalTitle"
    >
      <div class="dialog">
        <div class="h">
          <h2 id="sessionModalTitle">Edit Session</h2>
          <button id="closeSessionModal" class="btn-ghost" type="button" aria-label="Close session form">✕</button>
        </div>
        <div class="b">
          <div class="form-grid session-form modal-form-grid">
            <div class="form-field field-project">
              <label class="muted" for="sessionProject">Project</label>
              <select id="sessionProject" required></select>
            </div>
            <div class="form-field field-start">
              <label class="muted" for="sessionStartDate">Start</label>
              <div class="input-split">
                <input id="sessionStartDate" type="date" required />
                <input id="sessionStartTime" type="time" required />
              </div>
            </div>
            <div class="form-field field-end">
              <label class="muted" for="sessionEndDate">End</label>
              <div class="input-split">
                <input id="sessionEndDate" type="date" required />
                <input id="sessionEndTime" type="time" required />
              </div>
            </div>
            <div class="form-field field-duration">
              <label class="muted" for="sessionDuration">Duration</label>
              <div id="sessionDuration" class="session-duration" aria-live="polite">—</div>
            </div>
            <div class="form-field field-notes full-span">
              <label class="muted" for="sessionNote">Notes</label>
              <textarea id="sessionNote" placeholder="Optional context for this session..."></textarea>
            </div>
          </div>
          <input type="hidden" id="editingSessionId" />
          <div class="row" style="justify-content: flex-end">
            <button id="saveSession" class="btn-primary" type="button">Save Session</button>
          </div>
        </div>
      </div>
    </div>

    <div id="idleModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="idleModalTitle">
      <div class="dialog">
        <div class="h">
          <h2 id="idleModalTitle">Away time detected</h2>
        </div>
        <div class="b">
          <div class="idle-modal-summary">
            <h3 id="idleSummary">Away for 0s</h3>
            <p id="idleDetail"></p>
          </div>
          <div id="idleBaseActions" class="idle-modal-actions">
            <button id="idleDiscard" class="btn-ghost" type="button">Discard</button>
            <button id="idleAllocate" class="btn-primary" type="button">Allocate to Project</button>
            <button id="idleCreate" class="btn-accent" type="button">Create New Project</button>
          </div>
          <div id="idleAllocateSection" class="idle-modal-section hidden">
            <label class="muted" for="idleProjectSelect">Project</label>
            <select id="idleProjectSelect"></select>
            <label class="muted" for="idleEntryNote">Note (optional)</label>
            <textarea id="idleEntryNote" placeholder="Optional note about this away time..."></textarea>
            <div class="row">
              <button id="idleAllocateBack" class="btn-ghost" type="button">Back</button>
              <button id="idleAllocateConfirm" class="btn-primary" type="button">Save Entry</button>
            </div>
          </div>
          <div id="idleCreateSection" class="idle-modal-section hidden">
            <label class="muted" for="idleNewProjectName">Project Name</label>
            <input id="idleNewProjectName" placeholder="e.g. Team Meeting" />
            <label class="muted" for="idleNewProjectNote">Project Note (optional)</label>
            <textarea id="idleNewProjectNote" placeholder="Optional description for this project..."></textarea>
            <div class="row">
              <button id="idleCreateBack" class="btn-ghost" type="button">Back</button>
              <button id="idleCreateConfirm" class="btn-accent" type="button">Create &amp; Log Time</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
