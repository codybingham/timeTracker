<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FluidPowerTools — Time Tracker</title>
<meta name="theme-color" content="#0a0c10" />
<style>
:root{
  --bg:#0a0c10;
  --gradient:radial-gradient(1100px 700px at 85% -10%,#183049 0%,transparent 55%),radial-gradient(900px 600px at -10% 110%,#1e2740 0%,transparent 55%);
  --card:rgba(20,26,38,0.65);
  --card-2:rgba(18,22,33,0.55);
  --stroke:rgba(90,110,150,0.22);
  --text:#e9eef7;
  --muted:#9fb1cc;
  --accent:#4cc9f0;
  --danger:#ef476f;
  --shadow:0 10px 35px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.04);
  --radius:16px;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
  color:var(--text);background:var(--bg);background-image:var(--gradient);
}
header{
  position:sticky;top:0;z-index:50;display:flex;align-items:center;gap:14px;
  padding:14px 18px;background:rgba(8,12,20,.6);backdrop-filter:blur(10px);border-bottom:1px solid var(--stroke)
}
header h1{font-size:18px;margin:0;font-weight:700}
header .tag{font-size:12px;color:var(--muted);padding:2px 8px;border:1px solid var(--stroke);border-radius:999px}
header .spacer{margin-left:auto}
.container{max-width:1200px;margin:24px auto;padding:0 16px}
.grid{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
@media(max-width:1024px){.grid{grid-template-columns:1fr}}
.card{
  background:linear-gradient(180deg,var(--card),var(--card-2));border:1px solid var(--stroke);
  border-radius:var(--radius);box-shadow:var(--shadow);overflow:clip
}
.card .h{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid var(--stroke)}
.card .b{padding:16px}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
input,textarea,select{
  background:rgba(10,14,22,.9);border:1px solid var(--stroke);color:var(--text);
  border-radius:12px;padding:10px 12px;outline:none
}
input:focus,textarea:focus,select:focus{border-color:rgba(76,201,240,.7);box-shadow:0 0 0 2px rgba(76,201,240,.15)}
textarea{width:100%;min-height:60px;resize:vertical;font-size:14px}
button{
  border:1px solid var(--stroke);color:var(--text);
  background:linear-gradient(180deg,rgba(18,24,36,.9),rgba(14,18,30,.95));
  padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600
}
button:hover{border-color:rgba(120,170,220,.45)}
.btn-primary{background:linear-gradient(180deg,#204464,#162942);border-color:rgba(90,160,220,.45)}
.btn-accent{background:linear-gradient(180deg,#0b2a36,#0a2230);border-color:#1a6a86;color:#bff2ff}
.btn-danger{background:linear-gradient(180deg,#4a0e22,#230812);border-color:#80334c;color:#ffd9e3}
.btn-ghost{background:transparent}
.tabs{display:flex;gap:8px}
.tabs button[aria-selected="true"]{border-color:rgba(76,201,240,.7);box-shadow:0 0 0 1px rgba(76,201,240,.2) inset}
.hidden{display:none}
.muted{color:var(--muted)}
.pill{padding:4px 8px;border-radius:999px;background:rgba(12,18,28,.8);border:1px solid var(--stroke);font-size:12px}
table{width:100%;border-collapse:separate;border-spacing:0 8px}
thead th{font-size:12px;color:var(--muted);font-weight:600;text-align:left;padding:0 10px}
tbody tr{background:rgba(12,16,26,.85);border:1px solid var(--stroke)}
tbody td{padding:10px}

/* Project list (sleek collapsible) */
.project-wrap details{
  border:1px solid var(--stroke);border-radius:14px;padding:10px 12px;margin:10px 0;
  background:linear-gradient(180deg,rgba(18,24,36,.55),rgba(13,18,30,.6));
  transition:border-color .2s, box-shadow .2s, background .2s;
}
.project-wrap details:hover{border-color:rgba(76,201,240,.4);box-shadow:0 6px 22px rgba(0,0,0,.28)}
.project-wrap details[open]{border-color:rgba(76,201,240,.5);box-shadow:0 8px 26px rgba(0,0,0,.32)}
.project-summary{display:flex;align-items:flex-start;gap:12px;list-style:none;cursor:pointer}
.project-summary::-webkit-details-marker{display:none}
.project-title{font-weight:800;font-size:16px;margin:0}
.project-sub{color:var(--muted);font-size:13px;margin-top:2px}
.project-actions{margin-left:auto;display:flex;gap:8px}
.project-actions button{font-size:12px;padding:6px 8px}

/* Expanded content */
.project-notes{color:var(--muted);font-size:13px;margin-top:8px;white-space:pre-wrap}
.sessions-wrap details{margin-top:10px;border:1px dashed var(--stroke);border-radius:10px;padding:8px 10px}
.sessions-wrap summary{cursor:pointer;color:var(--muted);font-weight:600}
.session-line{margin:6px 0;color:var(--muted);font-size:13px}

/* Modal (glass aesthetic) */
.modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(6,10,16,.6);backdrop-filter:blur(6px)}
.modal:not(.hidden){display:grid}
.modal .dialog{width:min(720px,92vw);background:linear-gradient(180deg,rgba(18,24,36,.9),rgba(13,18,30,.94));
  border:1px solid var(--stroke);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
.modal .dialog .h{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--stroke)}
.modal .dialog .b{padding:16px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(min-width:680px){.form-grid{grid-template-columns:1fr 1fr 1fr 1fr}}
input[type="date"],input[type="time"]{appearance:auto!important;-webkit-appearance:auto!important;position:relative;z-index:5;background:#0e131d;color-scheme:dark}
</style>
</head>
<body>
<header>
  <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M3 12h5l3-8 3 16 3-8h4" stroke="#4cc9f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  <h1>Time Tracker</h1>
  <span class="tag">Standalone • Local only</span>
  <div class="spacer"></div>
  <button id="btnExport" class="btn-ghost">Export JSON</button>
  <input id="importFile" class="hidden" type="file" accept="application/json" />
  <button id="btnImport" class="btn-ghost">Import</button>
  <button id="btnCsv" class="btn-ghost">Export CSV</button>
  <button id="btnClear" class="btn-danger">Clear All</button>
</header>

<main class="container">
  <div class="tabs" style="margin-bottom:20px">
    <button id="tabActiveProjects" aria-selected="true">Active Projects</button>
    <button id="tabArchivedProjects" aria-selected="false">Archived Projects</button>
  </div>

  <div id="activeSection">
    <div class="grid">
      <section class="card">
        <div class="h">
          <h2>Projects</h2>
          <div class="row">
            <button id="openProjectModal" class="btn-primary">New Project</button>
          </div>
        </div>
        <div class="b project-wrap" id="projectList"></div>
      </section>

      <section class="card">
        <div class="h"><h2>Timer</h2>
          <div class="row">
            <select id="projectSelect"></select>
            <button id="startBtn" class="btn-accent">Start</button>
            <button id="stopBtn">Stop</button>
          </div>
        </div>
        <div class="b">
          <div class="pill">Current session</div>
          <div id="timeDisplay" style="font-size:40px;font-weight:800;margin-top:4px">00:00:00</div>
          <div id="noteBar" style="margin-top:12px;display:none;">
            <div class="row" style="align-items:center;">
              <input id="noteInput" placeholder="Add a note for this session..." style="flex:1;">
              <button id="saveNoteBtn" class="btn-primary">Save</button>
              <button id="cancelNoteBtn" class="btn-ghost">Cancel</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:20px">
      <div class="h"><h2>Totals</h2>
        <div class="row" style="margin-left:auto">
          <div class="tabs">
            <button id="tabDaily" aria-selected="true">Daily</button>
            <button id="tabWeekly" aria-selected="false">Weekly</button>
            <button id="tabAll" aria-selected="false">All-Time</button>
          </div>
          <button id="prevRange" class="btn-ghost">◀</button><div id="rangeLabel" class="pill">Today</div><button id="nextRange" class="btn-ghost">▶</button>
        </div>
      </div>
      <div class="b">
        <table>
          <thead><tr><th>Project</th><th>Entries</th><th>Total Time</th></tr></thead>
          <tbody id="totalsBody"></tbody>
        </table>
      </div>
    </section>

    <section class="card" style="margin-top:20px">
      <div class="h"><h2>All Entries (Active Projects)</h2></div>
      <div class="b" id="activeEntries"></div>
    </section>
  </div>

  <div id="archivedSection" class="hidden">
    <section class="card"><div class="h"><h2>Archived Projects</h2></div><div class="b project-wrap" id="archivedProjects"></div></section>
  </div>
</main>

<!-- Add/Edit Project Modal -->
<div id="projectModal" class="modal hidden">
  <div class="dialog">
    <div class="h">
      <h2 id="projectModalTitle">New Project</h2>
      <button id="closeProject" class="btn-ghost">✕</button>
    </div>
    <div class="b">
      <div class="form-grid" style="margin-bottom:10px">
        <div>
          <label class="muted" for="projNo">Project Number</label>
          <input id="projNo" placeholder="e.g. 455227" required>
        </div>
        <div>
          <label class="muted" for="taskNo">Task Number</label>
          <input id="taskNo" placeholder="e.g. HTK-03">
        </div>
        <div style="grid-column:1/-1">
          <label class="muted" for="projName">Project Name</label>
          <input id="projName" placeholder="e.g. BBL-1000 Hydraulic Tank" required>
        </div>
        <div>
          <label class="muted" for="startDate">Start Date</label>
          <input id="startDate" type="date" required>
        </div>
        <div>
          <label class="muted" for="endDate">End Date (optional)</label>
          <input id="endDate" type="date">
        </div>
        <div>
          <label class="muted" for="statusSel">Status</label>
          <select id="statusSel">
            <option>In Queue</option>
            <option>WIP</option>
            <option>On Hold</option>
            <option>Completed</option>
          </select>
        </div>
        <div style="grid-column:1/-1">
          <label class="muted" for="projNote">Notes</label>
          <textarea id="projNote" placeholder="Optional context for this project..."></textarea>
        </div>
      </div>
      <input type="hidden" id="editingProjectId">
      <div class="row" style="justify-content:flex-end">
        <button id="saveProject" class="btn-primary">Save Project</button>
      </div>
    </div>
  </div>
</div>

<script>
const LS_KEY='tt_v1';
const state=JSON.parse(localStorage.getItem(LS_KEY)||'{"projects":[],"sessions":[],"activeTimer":null}');
let saveTimer;
function save(){clearTimeout(saveTimer);saveTimer=setTimeout(()=>localStorage.setItem(LS_KEY,JSON.stringify(state)),200);}
function uid(){return Math.random().toString(36).slice(2,10);}
function today(){const d=new Date();d.setHours(0,0,0,0);return d;}
function startOfWeek(d){const t=new Date(d);const day=(t.getDay()+6)%7;t.setDate(t.getDate()-day);t.setHours(0,0,0,0);return t;}
function endOfWeek(d){const s=startOfWeek(d);const e=new Date(s);e.setDate(e.getDate()+7);return e;}
function formatHM(s){s=Math.floor(s);const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;return`${h>0?h+'h ':''}${(m>0||h>0)?m+'m ':''}${sec}s`.trim();}
function fmtDT(ms){return new Date(ms).toLocaleString();}

/* ===== Project Modal (Add + Edit) ===== */
function openProjectModal(mode='add', id=null){
  const title=document.getElementById('projectModalTitle');
  const editingIdEl=document.getElementById('editingProjectId');
  const p = id ? state.projects.find(x=>x.id===id) : null;

  title.textContent = mode==='edit' ? 'Edit Project' : 'New Project';
  editingIdEl.value = mode==='edit' && p ? p.id : '';

  // Defaults / Prefill
  const t=new Date(); const todayLocal=new Date(t.getTime()-t.getTimezoneOffset()*60000).toISOString().slice(0,10);
  document.getElementById('projNo').value = p?.projectNo || '';
  document.getElementById('taskNo').value = p?.taskNo || '';
  document.getElementById('projName').value = p?.name || '';
  document.getElementById('startDate').value = p?.startDate || todayLocal;
  document.getElementById('endDate').value = p?.endDate || '';
  document.getElementById('statusSel').value = p?.status || 'In Queue';
  document.getElementById('projNote').value = p?.note || '';

  const m=document.getElementById('projectModal');
  m.classList.remove('hidden');

  // Focus PN
  setTimeout(()=>document.getElementById('projNo').focus(),0);

  // help Chromium open date pickers on click
  ['startDate','endDate'].forEach(id=>{
    const el=document.getElementById(id);
    el.addEventListener('click',e=>{try{e.target.showPicker();}catch{}},{once:true});
  });
}
function closeProjectModal(){document.getElementById('projectModal').classList.add('hidden');}
function saveProjectFromModal(){
  const projectNo=document.getElementById('projNo').value.trim();
  const taskNo=document.getElementById('taskNo').value.trim();
  const name=document.getElementById('projName').value.trim();
  const startDate=document.getElementById('startDate').value;
  const endDate=document.getElementById('endDate').value;
  const status=document.getElementById('statusSel').value;
  const note=document.getElementById('projNote').value.trim();
  const editingId=document.getElementById('editingProjectId').value;

  if(!projectNo) return alert('Project Number is required.');
  if(!name) return alert('Project Name is required.');
  if(!startDate) return alert('Start Date is required.');

  if(editingId){
    const p=state.projects.find(x=>x.id===editingId);
    if(!p) return;
    Object.assign(p,{projectNo,taskNo,name,startDate,endDate,status,note});
  }else{
    state.projects.push({id:uid(),projectNo,taskNo,name,startDate,endDate,status,note,archived:false});
  }
  save(); closeProjectModal(); render();
}

/* ===== Projects render (collapsible; notes read-only) ===== */
function toggleArchive(id){const p=state.projects.find(p=>p.id===id);if(!p)return;p.archived=!p.archived;save();render();}

function renderProjects(containerId, archived){
  const wrap=document.getElementById(containerId);
  wrap.innerHTML='';
  for(const p of state.projects.filter(x=>x.archived===archived)){
    const det=document.createElement('details');

    const sum=document.createElement('summary');
    sum.className='project-summary';
    const metaLeft=document.createElement('div');
    metaLeft.style.flex='1';
    metaLeft.innerHTML=`
      <div class="project-title">${p.name || '(Unnamed Project)'}</div>
      <div class="project-sub">
        ${p.projectNo?`Project ${p.projectNo}`:'No Project #'}${p.taskNo?` · Task ${p.taskNo}`:''} · ${p.status||'In Queue'}
      </div>
    `;
    const actions=document.createElement('div');
    actions.className='project-actions';
    const btnEdit=document.createElement('button');
    btnEdit.className='btn-ghost'; btnEdit.textContent='Edit';
    btnEdit.onclick=(e)=>{e.stopPropagation();openProjectModal('edit', p.id);};
    const btnArch=document.createElement('button');
    btnArch.className='btn-ghost'; btnArch.textContent= archived ? 'Unarchive' : 'Archive';
    btnArch.onclick=(e)=>{e.stopPropagation();toggleArchive(p.id);};
    actions.append(btnEdit, btnArch);

    if (archived) {
      const btnDel = document.createElement('button');
      btnDel.className = 'btn-ghost';
      btnDel.textContent = 'Delete';
      btnDel.onclick = (e) => {
        e.stopPropagation();
        if (confirm(`⚠️ This will permanently delete "${p.name}" and all related sessions.\n\nContinue?`)) {
          state.projects = state.projects.filter(x => x.id !== p.id);
          state.sessions = state.sessions.filter(s => s.projectId !== p.id);
          save();
          render();
        }
      };
      actions.append(btnDel);
    }

    sum.append(metaLeft, actions);

    // Expanded: Notes + (for archived) nested Sessions dropdown
    const expanded=document.createElement('div');
    const notes=document.createElement('div');
    notes.className='project-notes';
    notes.innerHTML = (p.note && p.note.trim()) ? p.note.replace(/</g,'&lt;') : '<i>No notes</i>';
    expanded.appendChild(notes);

    if (archived) {
      const sessWrap=document.createElement('div');
      sessWrap.className='sessions-wrap';
      const sessDet=document.createElement('details'); // collapsed by default
      const sessSum=document.createElement('summary');
      sessSum.textContent='Sessions';
      sessDet.appendChild(sessSum);

      const entries=state.sessions.filter(s=>s.projectId===p.id);
      if (entries.length===0) {
        const none=document.createElement('div');
        none.className='session-line';
        none.innerHTML='<i>No recorded sessions</i>';
        sessDet.appendChild(none);
      } else {
        for (const e of entries) {
          const row=document.createElement('div');
          row.className='session-line';
          row.innerHTML = `• ${fmtDT(e.start)} — ${formatHM(e.seconds)}${e.note?` — <i>${e.note.replace(/</g,'&lt;')}</i>`:''}`;
          sessDet.appendChild(row);
        }
      }

      sessWrap.appendChild(sessDet);
      expanded.appendChild(sessWrap);
    }

    det.append(sum, expanded);
    wrap.appendChild(det);
  }
}

/* ===== Timer + inline note for last session ===== */
let tick,pendingNoteId=null;
function startTimer(){
  const pid=document.getElementById('projectSelect').value;
  if(!pid) return alert('Select project');
  if(state.activeTimer) return alert('Timer running');
  state.activeTimer={projectId:pid,start:Date.now()}; save();
  document.getElementById('noteBar').style.display='none';
  tick=setInterval(()=>{
    const sec=(Date.now()-state.activeTimer.start)/1000;
    document.getElementById('timeDisplay').textContent=new Date(sec*1000).toISOString().substr(11,8);
  },200);
}
function stopTimer(){
  if(!state.activeTimer) return alert('No active timer');
  const now=Date.now(),{projectId,start}=state.activeTimer;
  const seconds=Math.max(1,Math.round((now-start)/1000));
  const newSession={id:uid(),projectId,start,end:now,seconds,note:"",source:'timer'};
  state.sessions.push(newSession); pendingNoteId=newSession.id;
  clearInterval(tick); state.activeTimer=null; save(); render(); showNoteBar();
}
function showNoteBar(){const b=document.getElementById('noteBar');const i=document.getElementById('noteInput');b.style.display='block';i.value='';i.focus();}
document.getElementById('saveNoteBtn').onclick=()=>{if(!pendingNoteId)return;const s=state.sessions.find(x=>x.id===pendingNoteId);if(s)s.note=document.getElementById('noteInput').value.trim();pendingNoteId=null;document.getElementById('noteBar').style.display='none';save();render();};
document.getElementById('cancelNoteBtn').onclick=()=>{pendingNoteId=null;document.getElementById('noteBar').style.display='none';};

/* ===== Totals + Entries ===== */
let view='daily',anchor=today();
function range(){if(view==='daily')return[today(),new Date(today().getTime()+864e5)];if(view==='weekly'){const s=startOfWeek(anchor);return[s,endOfWeek(anchor)];}return[new Date(0),new Date(864e12)];}
function renderTotals(){
  const[s,e]=range(),l=document.getElementById('rangeLabel');
  l.textContent=view==='daily'?s.toLocaleDateString():view==='weekly'?`${s.toLocaleDateString()} – ${new Date(e-1).toLocaleDateString()}`:'All-Time';
  const tb=document.getElementById('totalsBody');tb.innerHTML='';
  for(const p of state.projects.filter(p=>!p.archived)){
    const es=state.sessions.filter(x=>new Date(x.start)>=s&&new Date(x.start)<e&&x.projectId===p.id);
    const sec=es.reduce((a,b)=>a+b.seconds,0);
    tb.innerHTML+=`<tr><td>${p.name}</td><td>${es.length}</td><td>${formatHM(sec)}</td></tr>`;
  }
}
function renderEntries(container, filterArchived){
  const wrap=document.getElementById(container); wrap.innerHTML='';
  for(const p of state.projects.filter(p=>p.archived===filterArchived)){
    const entries=state.sessions.filter(s=>s.projectId===p.id);
    const det=document.createElement('details');
    const summary=document.createElement('summary');
    summary.textContent=`${p.name} (${entries.length})`;
    det.appendChild(summary);

    const list=document.createElement('div'); list.className='project-notes';
    for(const e of entries){
      const row=document.createElement('div');
      row.style.margin='6px 0';
      row.innerHTML = `• ${fmtDT(e.start)} — ${formatHM(e.seconds)} ${e.note?`— <i>${e.note.replace(/</g,'&lt;')}</i>`:''}`;
      list.appendChild(row);
    }
    det.appendChild(list);
    wrap.appendChild(det);
  }
}

/* ===== Render root ===== */
function render(){
  renderProjects('projectList',false);
  renderProjects('archivedProjects',true);

  const s=document.getElementById('projectSelect');
  s.innerHTML='<option value="">Select project...</option>' + state.projects.filter(p=>!p.archived).map(p=>`<option value="${p.id}">${p.name}</option>`).join('');

  renderTotals();
  renderEntries('activeEntries',false);
}

/* ===== Tabs & Controls ===== */
document.getElementById('tabDaily').onclick=()=>{view='daily';renderTotals()};
document.getElementById('tabWeekly').onclick=()=>{view='weekly';renderTotals()};
document.getElementById('tabAll').onclick=()=>{view='all';renderTotals()};
document.getElementById('prevRange').onclick=()=>{if(view==='daily')anchor.setDate(anchor.getDate()-1);else if(view==='weekly')anchor.setDate(anchor.getDate()-7);renderTotals();};
document.getElementById('nextRange').onclick=()=>{if(view==='daily')anchor.setDate(anchor.getDate()+1);else if(view==='weekly')anchor.setDate(anchor.getDate()+7);renderTotals();};
document.getElementById('tabActiveProjects').onclick=()=>{document.getElementById('activeSection').classList.remove('hidden');document.getElementById('archivedSection').classList.add('hidden');document.getElementById('tabActiveProjects').setAttribute('aria-selected',true);document.getElementById('tabArchivedProjects').setAttribute('aria-selected',false);};
document.getElementById('tabArchivedProjects').onclick=()=>{document.getElementById('archivedSection').classList.remove('hidden');document.getElementById('activeSection').classList.add('hidden');document.getElementById('tabArchivedProjects').setAttribute('aria-selected',true);document.getElementById('tabActiveProjects').setAttribute('aria-selected',false);};

/* Buttons */
document.getElementById('openProjectModal').onclick=()=>openProjectModal('add');
document.getElementById('closeProject').onclick=closeProjectModal;
document.getElementById('projectModal').onclick=e=>{if(e.target.id==='projectModal')closeProjectModal()};
document.getElementById('saveProject').onclick=saveProjectFromModal;

document.getElementById('startBtn').onclick=startTimer;
document.getElementById('stopBtn').onclick=stopTimer;

document.getElementById('btnExport').onclick=()=>{const b=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='time-tracker.json';a.click();};
document.getElementById('btnCsv').onclick=()=>{const r=[['Project','Start','End','Seconds','Note','Source']];for(const s of state.sessions){const p=state.projects.find(p=>p.id===s.projectId);r.push([p?p.name:'Unknown',fmtDT(s.start),fmtDT(s.end),s.seconds,s.note||'',s.source||'']);}const csv=r.map(x=>x.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');const b=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='time-tracker.csv';a.click();};
document.getElementById('btnImport').onclick=()=>document.getElementById('importFile').click();
document.getElementById('importFile').onchange=e=>{const r=new FileReader();r.onload=()=>{try{Object.assign(state,JSON.parse(r.result));save();render();}catch{alert('Invalid JSON')}};r.readAsText(e.target.files[0]);};
document.getElementById('btnClear').onclick=()=>{if(confirm("Clear all data?")){localStorage.removeItem(LS_KEY);location.reload();}};

/* Init */
render();
</script>
</body>
</html>
